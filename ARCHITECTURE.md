# Architecture LibriAssist - Vue d'ensemble

## ğŸ—ï¸ Architecture systÃ¨me complÃ¨te

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UTILISATEUR                              â”‚
â”‚                    (Navigateur Web)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      FRONTEND (Next.js 14)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                   Interface Utilisateur                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   Header    â”‚  â”‚ WelcomeScreenâ”‚  â”‚ MessageBubble  â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚  InputBox   â”‚  â”‚ChatInterface â”‚  â”‚   API Client   â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Technologies:                                                   â”‚
â”‚  â€¢ Next.js 14 (App Router)                                      â”‚
â”‚  â€¢ TypeScript                                                    â”‚
â”‚  â€¢ Tailwind CSS                                                  â”‚
â”‚  â€¢ Framer Motion                                                â”‚
â”‚  â€¢ Axios                                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ REST API
                             â”‚ POST /api/v1/chat
                             â”‚ GET /api/v1/health
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   BACKEND (FastAPI Python)                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    API Layer                              â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚   /chat     â”‚  â”‚   /health    â”‚  â”‚    /stats      â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  Endpoint   â”‚  â”‚   Endpoint   â”‚  â”‚   Endpoint     â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚            â”‚                                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  RAG Pipeline Service                      â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚  1. GÃ©nÃ©ration embeddings de la question            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  2. Recherche dans VectorStore                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  3. Reranking des rÃ©sultats                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  4. Construction du prompt                           â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  5. GÃ©nÃ©ration rÃ©ponse LLM                          â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  6. Formatage + sources                              â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚              â”‚                  â”‚               â”‚                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  PDF Processor     â”‚  â”‚ Embeddings â”‚  â”‚  VectorStore   â”‚   â”‚
â”‚  â”‚                    â”‚  â”‚  Service   â”‚  â”‚    Service     â”‚   â”‚
â”‚  â”‚  â€¢ Extraction      â”‚  â”‚            â”‚  â”‚                â”‚   â”‚
â”‚  â”‚  â€¢ Chunking        â”‚  â”‚ Sentence   â”‚  â”‚   ChromaDB     â”‚   â”‚
â”‚  â”‚  â€¢ Nettoyage       â”‚  â”‚Transformersâ”‚  â”‚                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â”‚  Technologies:                                                   â”‚
â”‚  â€¢ FastAPI                                                       â”‚
â”‚  â€¢ ChromaDB                                                      â”‚
â”‚  â€¢ SentenceTransformers (all-MiniLM-L6-v2)                     â”‚
â”‚  â€¢ LangChain                                                     â”‚
â”‚  â€¢ PyPDF2 / pdfplumber                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ HTTP
                             â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    OLLAMA (LLM Server)                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Mistral 7B (ou Llama 3)                      â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  â€¢ ModÃ¨le de langage local                                â”‚  â”‚
â”‚  â”‚  â€¢ GÃ©nÃ©ration de rÃ©ponses                                 â”‚  â”‚
â”‚  â”‚  â€¢ QuantifiÃ© pour performance CPU                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                  â”‚
â”‚  Port: 11434                                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   STOCKAGE DES DONNÃ‰ES                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Documents     â”‚      â”‚      Vector Database             â”‚   â”‚
â”‚  â”‚     (PDF)       â”‚      â”‚       (ChromaDB)                 â”‚   â”‚
â”‚  â”‚                 â”‚      â”‚                                   â”‚   â”‚
â”‚  â”‚  docs/          â”‚  â†’   â”‚  data/vectorstore/               â”‚   â”‚
â”‚  â”‚  â””â”€FAQ.pdf      â”‚      â”‚  â””â”€chroma.sqlite3                â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Flux de donnÃ©es dÃ©taillÃ©

### 1ï¸âƒ£ Indexation des documents (une fois)

```
PDF Documents
    â”‚
    â”œâ”€â†’ PDFProcessor.extract_text()
    â”‚   â””â”€â†’ Texte brut
    â”‚
    â”œâ”€â†’ PDFProcessor.clean_text()
    â”‚   â””â”€â†’ Texte nettoyÃ©
    â”‚
    â”œâ”€â†’ LangChain TextSplitter
    â”‚   â””â”€â†’ Chunks (800 tokens, overlap 100)
    â”‚
    â”œâ”€â†’ EmbeddingService.embed_texts()
    â”‚   â””â”€â†’ Vecteurs (384 dimensions)
    â”‚
    â””â”€â†’ VectorStore.add_documents()
        â””â”€â†’ ChromaDB (stockage persistant)
```

### 2ï¸âƒ£ Question â†’ RÃ©ponse (runtime)

```
Question utilisateur
    â”‚
    â”œâ”€â†’ Frontend (InputBox)
    â”‚   â””â”€â†’ POST /api/v1/chat
    â”‚
    â”œâ”€â†’ Backend (FastAPI)
    â”‚   â””â”€â†’ RAGPipeline.generate_response()
    â”‚
    â”œâ”€â†’ EmbeddingService.embed_text(question)
    â”‚   â””â”€â†’ Vecteur question (384d)
    â”‚
    â”œâ”€â†’ VectorStore.similarity_search()
    â”‚   â””â”€â†’ Top-5 documents similaires
    â”‚
    â”œâ”€â†’ RAGPipeline.rerank_documents()
    â”‚   â””â”€â†’ Top-3 passages les plus pertinents
    â”‚
    â”œâ”€â†’ RAGPipeline.format_context()
    â”‚   â””â”€â†’ Prompt avec contexte
    â”‚
    â”œâ”€â†’ OllamaService.generate_response()
    â”‚   â””â”€â†’ LLM Mistral 7B
    â”‚       â””â”€â†’ RÃ©ponse en langage naturel
    â”‚
    â””â”€â†’ Frontend (MessageBubble)
        â””â”€â†’ Affichage rÃ©ponse + sources
```

---

## ğŸ“Š Composants principaux

### Backend Services

| Service | ResponsabilitÃ© | Fichier |
|---------|---------------|---------|
| **PDFProcessor** | Extraction et chunking PDF | `pdf_processor.py` |
| **EmbeddingService** | GÃ©nÃ©ration embeddings | `embeddings.py` |
| **VectorStoreService** | Recherche vectorielle | `vectorstore.py` |
| **OllamaService** | Communication LLM | `llm.py` |
| **RAGPipeline** | Orchestration complÃ¨te | `rag_pipeline.py` |

### Frontend Components

| Component | ResponsabilitÃ© | Fichier |
|-----------|---------------|---------|
| **ChatInterface** | Orchestrateur principal | `ChatInterface.tsx` |
| **Header** | En-tÃªte et navigation | `Header.tsx` |
| **WelcomeScreen** | Ã‰cran accueil | `WelcomeScreen.tsx` |
| **MessageBubble** | Affichage messages | `MessageBubble.tsx` |
| **InputBox** | Saisie utilisateur | `InputBox.tsx` |

---

## ğŸ” SÃ©curitÃ© et Performance

### SÃ©curitÃ©
- âœ… CORS configurÃ©
- âœ… Validation Pydantic
- âœ… DonnÃ©es locales (pas de cloud)
- âœ… Pas d'exÃ©cution de code arbitraire

### Performance
- âœ… Cache des rÃ©ponses frÃ©quentes
- âœ… ChromaDB avec index HNSW
- âœ… LLM quantifiÃ© 4-bit
- âœ… Async FastAPI
- âœ… Reranking pour rÃ©duire contexte LLM

---

## ğŸŒ Ports utilisÃ©s

| Service | Port | URL |
|---------|------|-----|
| Frontend | 3000 | http://localhost:3000 |
| Backend API | 8000 | http://localhost:8000 |
| Ollama | 11434 | http://localhost:11434 |

---

## ğŸ’¾ Stockage des donnÃ©es

### ChromaDB
```
data/vectorstore/
â”œâ”€â”€ chroma.sqlite3      # Base de donnÃ©es SQLite
â”œâ”€â”€ index/              # Index HNSW
â””â”€â”€ metadata/           # MÃ©tadonnÃ©es documents
```

### Documents sources
```
docs/
â””â”€â”€ FAQ CoolLibri.pdf   # Document source indexÃ©
```

---

## ğŸ”§ Configuration

### Backend (.env)
```env
OLLAMA_MODEL=mistral:7b
CHUNK_SIZE=800
CHUNK_OVERLAP=100
TOP_K_RESULTS=5
RERANK_TOP_N=3
EMBEDDING_MODEL=all-MiniLM-L6-v2
```

### Frontend (.env.local)
```env
NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
```

---

Cette architecture garantit :
- âœ… **SÃ©paration des responsabilitÃ©s** (Frontend/Backend)
- âœ… **ModularitÃ©** (services dÃ©couplÃ©s)
- âœ… **ScalabilitÃ©** (prÃªt pour production)
- âœ… **Performance** (cache, indexation, async)
- âœ… **MaintenabilitÃ©** (code clair et documentÃ©)
